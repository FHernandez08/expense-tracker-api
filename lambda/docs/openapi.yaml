openapi: 3.0.3
info:
  title: Expense Tracker API
  description: >
    A serverless Expense Tracker API built with AWS CDK, API Gateway (HTTP API),
    AWS Lambda, Cognito JWT authentication, and DynamoDB.
  version: 1.0.0

servers:
  - url: https://t5gbf3g304.execute-api.us-east-1.amazonaws.com # Check if this matches your current URL

tags:
  - name: Auth
  - name: System
  - name: Categories
  - name: Budgets
  - name: Transactions
  - name: Rules
  - name: Docs

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:
    # Onboarding Schemas
    SignupRequest:
      type: object
      required: [email, password]
      properties:
        email: { type: string, example: "fidel@example.com" }
        password: { type: string, example: "StrongPassword123!" }

    # Core Schemas
    CategoryRequest:
      type: object
      required: [name]
      properties:
        name: { type: string, example: "Food" }

    BudgetRequest:
      type: object
      required: [categoryId, amount]
      properties:
        categoryId: { type: string, example: "uuid-123" }
        amount: { type: number, example: 500 }

    RuleRequest:
      type: object
      required: [name, amount, categoryId, dayOfMonth]
      properties:
        name: { type: string, example: "Netflix" }
        amount: { type: number, example: 15.99 }
        categoryId: { type: string, example: "uuid-123" }
        dayOfMonth: { type: integer, example: 15 }

    SummaryResponse:
      type: object
      properties:
        month: { type: string, example: "2026-02" }
        totalBudgeted: { type: number, example: 2000 }
        totalSpent: { type: number, example: 450 }
        remaining: { type: number, example: 1550 }
        transactionCount: { type: integer, example: 10 }
        budgetCount: { type: integer, example: 5 }

paths:
  # --- PUBLIC ROUTES ---
  /signup:
    post:
      tags: [Auth]
      summary: Register a new account
      requestBody:
        content:
          application/json:
            schema: { $ref: "#/components/schemas/SignupRequest" }
      responses:
        "201": { description: "User created" }

  /confirm:
    post:
      tags: [Auth]
      summary: Verify email with code
      responses:
        "200": { description: "User confirmed" }

  /login:
    post:
      tags: [Auth]
      summary: Get JWT token
      responses:
        "200": { description: "Returns idToken" }

  /health:
    get:
      tags: [System]
      responses:
        "200": { description: "OK" }

  /docs:
    get:
      tags: [Docs]
      responses:
        "200": { description: "Swagger UI" }

  /openapi.yaml:
    get:
      tags: [Docs]
      responses:
        "200": { description: "YAML Spec" }

  # --- PROTECTED ROUTES ---
  /summary:
    get:
      tags: [System]
      security: [{ bearerAuth: [] }]
      parameters:
        - name: month
          in: query
          required: true
          schema: { type: string, example: "2026-02" }
      responses:
        "200":
          content:
            application/json:
              schema: { $ref: "#/components/schemas/SummaryResponse" }

  /categories:
    get:
      tags: [Categories]
      security: [{ bearerAuth: [] }]
      responses:
        "200": { description: "List of categories" }
    post:
      tags: [Categories]
      security: [{ bearerAuth: [] }]
      requestBody:
        content:
          application/json:
            schema: { $ref: "#/components/schemas/CategoryRequest" }
      responses:
        "201": { description: "Created" }

  /budgets:
    get:
      tags: [Budgets]
      security: [{ bearerAuth: [] }]
      responses:
        "200": { description: "List of budgets" }
    post:
      tags: [Budgets]
      security: [{ bearerAuth: [] }]
      requestBody:
        content:
          application/json:
            schema: { $ref: "#/components/schemas/BudgetRequest" }
      responses:
        "201": { description: "Created" }

  /rules:
    post:
      tags: [Rules]
      security: [{ bearerAuth: [] }]
      requestBody:
        content:
          application/json:
            schema: { $ref: "#/components/schemas/RuleRequest" }
      responses:
        "201": { description: "Rule created" }